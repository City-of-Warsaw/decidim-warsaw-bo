<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Decidim::Projects::Admin::UpdateProject
  
    &mdash; Dokumentacja Decidim BO
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Decidim::Projects::Admin::UpdateProject";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (U)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Projects.html" title="Decidim::Projects (module)">Projects</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Admin.html" title="Decidim::Projects::Admin (module)">Admin</a></span></span>
     &raquo; 
    <span class="title">UpdateProject</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Decidim::Projects::Admin::UpdateProject
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Rectify::Command</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Rectify::Command</li>
          
            <li class="next">Decidim::Projects::Admin::UpdateProject</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd>AttachmentMethods, <span class='object_link'><a href="../../EmailChecker.html" title="Decidim::EmailChecker (module)">EmailChecker</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html" title="Decidim::Projects::CustomAttachmentsMethods (module)">CustomAttachmentsMethods</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>decidim-projects/app/commands/decidim/projects/admin/update_project.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>A command with all the business logic when a user updates a project.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#attachment-instance_method" title="#attachment (instance method)">#<strong>attachment</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute attachment.</p>
</div></span>
  
</li>

    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#form-instance_method" title="#form (instance method)">#<strong>form</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute form.</p>
</div></span>
  
</li>

    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#gallery-instance_method" title="#gallery (instance method)">#<strong>gallery</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute gallery.</p>
</div></span>
  
</li>

    
      <li class="private ">
  <span class="summary_signature">
    
      <a href="#project-instance_method" title="#project (instance method)">#<strong>project</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute project.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#attachments_save_and_list-instance_method" title="#attachments_save_and_list (instance method)">#<strong>attachments_save_and_list</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#author_attributes-instance_method" title="#author_attributes (instance method)">#<strong>author_attributes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: author attributes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#call-instance_method" title="#call (instance method)">#<strong>call</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Executes the command.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#coauthors_attributes-instance_method" title="#coauthors_attributes (instance method)">#<strong>coauthors_attributes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: return coauthors attributes.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#handled_project_attributes-instance_method" title="#handled_project_attributes (instance method)">#<strong>handled_project_attributes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: adding scope to attributes if it was present in form and current user is admin (only admin can change scope).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(form, project, subaction = nil)  &#x21d2; UpdateProject </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Public: Initializes the command.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#no_data-instance_method" title="#no_data (instance method)">#<strong>no_data</strong>(v)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#organization-instance_method" title="#organization (instance method)">#<strong>organization</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>private method.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#project_attributes-instance_method" title="#project_attributes (instance method)">#<strong>project_attributes</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: project attributes.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#send_notification-instance_method" title="#send_notification (instance method)">#<strong>send_notification</strong>(project)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: send message to project authors.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#temporary_update_project-instance_method" title="#temporary_update_project (instance method)">#<strong>temporary_update_project</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: temporal update.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#update_coauthors_data-instance_method" title="#update_coauthors_data (instance method)">#<strong>update_coauthors_data</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: update coauthors data returns nothing.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#update_creator_data-instance_method" title="#update_creator_data (instance method)">#<strong>update_creator_data</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: update author data.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#update_department-instance_method" title="#update_department (instance method)">#<strong>update_department</strong>(project)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: update current department i project.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#update_project-instance_method" title="#update_project (instance method)">#<strong>update_project</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Private: update project.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../EmailChecker.html" title="Decidim::EmailChecker (module)">EmailChecker</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../EmailChecker.html#valid_email%3F-instance_method" title="Decidim::EmailChecker#valid_email? (method)">#valid_email?</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../CustomAttachmentsMethods.html" title="Decidim::Projects::CustomAttachmentsMethods (module)">CustomAttachmentsMethods</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../CustomAttachmentsMethods.html#attachment_attrs-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#attachment_attrs (method)">#attachment_attrs</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#attachments_invalid%3F-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#attachments_invalid? (method)">#attachments_invalid?</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#attachments_to_remove-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#attachments_to_remove (method)">#attachments_to_remove</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#build_attachments-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#build_attachments (method)">#build_attachments</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#build_consents_for-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#build_consents_for (method)">#build_consents_for</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#build_endorsements_for-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#build_endorsements_for (method)">#build_endorsements_for</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#build_files_for-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#build_files_for (method)">#build_files_for</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#build_implementation_photos_for-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#build_implementation_photos_for (method)">#build_implementation_photos_for</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#build_internal_documents_for-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#build_internal_documents_for (method)">#build_internal_documents_for</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#consents_invalid%3F-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#consents_invalid? (method)">#consents_invalid?</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#create_attachments-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#create_attachments (method)">#create_attachments</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#document_cleanup!-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#document_cleanup! (method)">#document_cleanup!</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#documents_attached_to-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#documents_attached_to (method)">#documents_attached_to</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#endorsements_invalid%3F-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#endorsements_invalid? (method)">#endorsements_invalid?</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#files_invalid%3F-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#files_invalid? (method)">#files_invalid?</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#implementation_photos_invalid%3F-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#implementation_photos_invalid? (method)">#implementation_photos_invalid?</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#internal_documents_invalid%3F-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#internal_documents_invalid? (method)">#internal_documents_invalid?</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#process_attachments%3F-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#process_attachments? (method)">#process_attachments?</a></span>, <span class='object_link'><a href="../CustomAttachmentsMethods.html#remove_attachments-instance_method" title="Decidim::Projects::CustomAttachmentsMethods#remove_attachments (method)">#remove_attachments</a></span></p>

  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(form, project, subaction = nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Decidim::Projects::Admin::UpdateProject (class)">UpdateProject</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Public: Initializes the command.</p>

<p>form         - A form object with the params. project      - the proposal to update. subaction    - String</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 17</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_form'>form</span><span class='comma'>,</span> <span class='id identifier rubyid_project'>project</span><span class='comma'>,</span> <span class='id identifier rubyid_subaction'>subaction</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@form</span> <span class='op'>=</span> <span class='id identifier rubyid_form'>form</span>
  <span class='ivar'>@project</span> <span class='op'>=</span> <span class='id identifier rubyid_project'>project</span>
  <span class='ivar'>@attached_to</span> <span class='op'>=</span> <span class='id identifier rubyid_project'>project</span>
  <span class='ivar'>@with_attachments</span> <span class='op'>=</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:add_documents</span><span class='rparen'>)</span>
  <span class='ivar'>@documents</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='ivar'>@subaction</span> <span class='op'>=</span> <span class='id identifier rubyid_subaction'>subaction</span>
  <span class='ivar'>@coauthors_emails</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor_one'>coauthor_one</span><span class='op'>&amp;.</span><span class='id identifier rubyid_email'>email</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span><span class='comma'>,</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor_two'>coauthor_two</span><span class='op'>&amp;.</span><span class='id identifier rubyid_email'>email</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="attachment-instance_method">
  
    #<strong>attachment</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly, private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute attachment.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_attachment'>attachment</span>
  <span class='ivar'>@attachment</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="form-instance_method">
  
    #<strong>form</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly, private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute form.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_form'>form</span>
  <span class='ivar'>@form</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="gallery-instance_method">
  
    #<strong>gallery</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly, private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute gallery.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gallery'>gallery</span>
  <span class='ivar'>@gallery</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="project-instance_method">
  
    #<strong>project</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly, private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute project.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


98
99
100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 98</span>

<span class='kw'>def</span> <span class='id identifier rubyid_project'>project</span>
  <span class='ivar'>@project</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="attachments_save_and_list-instance_method">
  
    #<strong>attachments_save_and_list</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 293</span>

<span class='kw'>def</span> <span class='id identifier rubyid_attachments_save_and_list'>attachments_save_and_list</span>
  <span class='id identifier rubyid_temp_files'>temp_files</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@endorsements</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:save</span><span class='rparen'>)</span>
  <span class='ivar'>@endorsements</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_element'>element</span><span class='op'>|</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>temporary_file:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>endorsements:</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_endorsements'>to_add_endorsements</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_endorsements'>to_add_endorsements</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>endorsements:</span> <span class='ivar'>@endorsements</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@endorsements</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='ivar'>@internal_documents</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:save</span><span class='rparen'>)</span>
  <span class='ivar'>@internal_documents</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_element'>element</span><span class='op'>|</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>temporary_file:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rbrace'>}</span>


  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>internal_documents:</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_internal_documents'>to_add_internal_documents</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_internal_documents'>to_add_internal_documents</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>internal_documents:</span> <span class='ivar'>@internal_documents</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@internal_documents</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='ivar'>@consents</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:save</span><span class='rparen'>)</span>
  <span class='ivar'>@consents</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_element'>element</span><span class='op'>|</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>temporary_file:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rbrace'>}</span>

  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>consents:</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_consents'>to_add_consents</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_consents'>to_add_consents</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>consents:</span> <span class='ivar'>@consents</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@consents</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='ivar'>@files</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:save</span><span class='rparen'>)</span>
  <span class='ivar'>@files</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_element'>element</span><span class='op'>|</span> <span class='id identifier rubyid_element'>element</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>temporary_file:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>files:</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_files'>to_add_files</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@form</span><span class='period'>.</span><span class='id identifier rubyid_to_add_files'>to_add_files</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
  <span class='id identifier rubyid_temp_files'>temp_files</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='label'>files:</span> <span class='ivar'>@files</span><span class='period'>.</span><span class='id identifier rubyid_pluck'>pluck</span><span class='lparen'>(</span><span class='symbol'>:id</span><span class='rparen'>)</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@files</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>

  <span class='id identifier rubyid_temp_files'>temp_files</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="author_attributes-instance_method">
  
    #<strong>author_attributes</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: author attributes</p>

<p>returns Hash</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 221</span>

<span class='kw'>def</span> <span class='id identifier rubyid_author_attributes'>author_attributes</span>
  <span class='lbrace'>{</span>
    <span class='label'>email:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='comma'>,</span>
    <span class='label'>first_name:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_first_name'>first_name</span><span class='comma'>,</span>
    <span class='label'>last_name:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_last_name'>last_name</span><span class='comma'>,</span>
    <span class='label'>gender:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_gender'>gender</span><span class='comma'>,</span>
    <span class='label'>phone_number:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_phone_number'>phone_number</span><span class='comma'>,</span>
    <span class='label'>street:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_street'>street</span><span class='comma'>,</span>
    <span class='label'>street_number:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_street_number'>street_number</span><span class='comma'>,</span>
    <span class='label'>flat_number:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_flat_number'>flat_number</span><span class='comma'>,</span>
    <span class='label'>zip_code:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_zip_code'>zip_code</span><span class='comma'>,</span>
    <span class='label'>city:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_city'>city</span><span class='comma'>,</span>
    <span class='comment'># agreements
</span>    <span class='label'>show_author_name:</span> <span class='const'>ActiveModel</span><span class='op'>::</span><span class='const'>Type</span><span class='op'>::</span><span class='const'>Boolean</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_show_author_name'>show_author_name</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='label'>inform_author_about_implementations:</span> <span class='const'>ActiveModel</span><span class='op'>::</span><span class='const'>Type</span><span class='op'>::</span><span class='const'>Boolean</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_inform_author_about_implementations'>inform_author_about_implementations</span><span class='rparen'>)</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="call-instance_method">
  
    #<strong>call</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Executes the command. Broadcasts these events:</p>
<ul><li>
<p>:ok when everything is valid, together with the proposal.</p>
</li><li>
<p>:invalid if the form wasn&#39;t valid and we couldn&#39;t proceed.</p>
</li><li>
<p>:invalid if attachments are invalid.</p>
</li></ul>

<p>Method allows for classic updating project or temporary updating project, that needs to be accepted. With proper value in variable @subaction temporary update can be instantly followed by acceptance of the temporaly changes</p>

<p>Returns nothing.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_call'>call</span>
  <span class='const'>Rails</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>UPDATE_PROJEKCT</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='id identifier rubyid_broadcast'>broadcast</span><span class='lparen'>(</span><span class='symbol'>:invalid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_invalid?'>invalid?</span>

  <span class='comment'># delete_attachment(form.attachment) if delete_attachment?
</span>  <span class='comment'>#
</span>  <span class='comment'># if process_attachments?
</span>  <span class='comment'>#   @project.attachments.destroy_all
</span>  <span class='comment'>#
</span>  <span class='comment'>#   build_attachment
</span>  <span class='comment'>#   return broadcast(:invalid) if attachment_invalid?
</span>  <span class='comment'># end
</span>
  <span class='comment'># if @with_attachments
</span>  <span class='comment'>#   build_attachments
</span>  <span class='comment'>#   return broadcast(:invalid) if attachments_invalid?
</span>  <span class='comment'># end
</span>
  <span class='id identifier rubyid_build_internal_documents_for'>build_internal_documents_for</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_build_endorsements_for'>build_endorsements_for</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_build_consents_for'>build_consents_for</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_build_files_for'>build_files_for</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_broadcast'>broadcast</span><span class='lparen'>(</span><span class='symbol'>:invalid</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_endorsements_invalid?'>endorsements_invalid?</span><span class='lparen'>(</span><span class='label'>project:</span> <span class='id identifier rubyid_project'>project</span><span class='comma'>,</span> <span class='label'>max_files_num:</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='op'>||</span>
    <span class='id identifier rubyid_files_invalid?'>files_invalid?</span><span class='lparen'>(</span><span class='label'>project:</span> <span class='id identifier rubyid_project'>project</span><span class='comma'>,</span> <span class='label'>max_files_num:</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='op'>||</span>
    <span class='id identifier rubyid_consents_invalid?'>consents_invalid?</span><span class='lparen'>(</span><span class='label'>project:</span> <span class='id identifier rubyid_project'>project</span><span class='comma'>,</span> <span class='label'>max_files_num:</span> <span class='kw'>nil</span><span class='rparen'>)</span> <span class='op'>||</span>
    <span class='id identifier rubyid_internal_documents_invalid?'>internal_documents_invalid?</span>


  <span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_any_draft?'>any_draft?</span> <span class='op'>||</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_ad_admin?'>ad_admin?</span> <span class='op'>||</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_ad_coordinator?'>ad_coordinator?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@subaction</span> <span class='op'>!=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>save-accept</span><span class='tstring_end'>&#39;</span></span>
      <span class='comment'># projects, that can be updated
</span>      <span class='comment'># drafts - with invisible version
</span>      <span class='comment'># when update is made by admin or coordinator
</span>      <span class='id identifier rubyid_update_project'>update_project</span>
      <span class='id identifier rubyid_remove_attachments'>remove_attachments</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_send_notification'>send_notification</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='comment'># projects, that can not be be updated
</span>      <span class='comment'># and need confirmation
</span>
      <span class='id identifier rubyid_temporary_update_project'>temporary_update_project</span>

      <span class='kw'>if</span> <span class='ivar'>@subaction</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>save-accept</span><span class='tstring_end'>&#39;</span></span>
        <span class='comment'># and accept -&gt; current_user is the actor of the action, and admin_changes are cleared
</span>        <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Projects.html" title="Decidim::Projects (module)">Projects</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Admin.html" title="Decidim::Projects::Admin (module)">Admin</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="AcceptChanges.html" title="Decidim::Projects::Admin::AcceptChanges (class)">AcceptChanges</a></span></span><span class='period'>.</span><span class='id identifier rubyid_call'><span class='object_link'><a href="AcceptChanges.html#call-instance_method" title="Decidim::Projects::Admin::AcceptChanges#call (method)">call</a></span></span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_component'>component</span><span class='comma'>,</span> <span class='ivar'>@current_user</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_remove_attachments'>remove_attachments</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_send_notification'>send_notification</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_remove_attachments'>remove_attachments</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>

  <span class='kw'>end</span>

  <span class='id identifier rubyid_broadcast'>broadcast</span><span class='lparen'>(</span><span class='symbol'>:ok</span><span class='comma'>,</span> <span class='id identifier rubyid_project'>project</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="coauthors_attributes-instance_method">
  
    #<strong>coauthors_attributes</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: return coauthors attributes</p>

<p>returns Array of hash</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 242</span>

<span class='kw'>def</span> <span class='id identifier rubyid_coauthors_attributes'>coauthors_attributes</span>
  <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
    <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>email:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_email</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='op'>&amp;.</span><span class='id identifier rubyid_strip'>strip</span><span class='comma'>,</span>
      <span class='label'>first_name:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_first_name</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>last_name:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_last_name</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>gender:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_gender</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>phone_number:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_phone_number</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>street:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_street</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>street_number:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_street_number</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>flat_number:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_flat_number</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>zip_code:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_zip_code</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>city:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_city</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='comment'># agreements
</span>      <span class='label'>show_author_name:</span> <span class='const'>ActiveModel</span><span class='op'>::</span><span class='const'>Type</span><span class='op'>::</span><span class='const'>Boolean</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_show_author_name</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>inform_author_about_implementations:</span> <span class='const'>ActiveModel</span><span class='op'>::</span><span class='const'>Type</span><span class='op'>::</span><span class='const'>Boolean</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='period'>.</span><span class='id identifier rubyid_cast'>cast</span><span class='lparen'>(</span><span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_send'>send</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>coauthor</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span><span class='embexpr_end'>}</span><span class='tstring_content'>_inform_author_about_implementations</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='rbrace'>}</span>
    <span class='id identifier rubyid_h'>h</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:present?</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='op'>?</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>:</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handled_project_attributes-instance_method">
  
    #<strong>handled_project_attributes</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: adding scope to attributes if it was present in form and current user is admin (only admin can change scope)</p>

<p>returns Hash</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


174
175
176</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 174</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handled_project_attributes'>handled_project_attributes</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_any_draft?'>any_draft?</span> <span class='op'>||</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_ad_admin?'>ad_admin?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span> <span class='op'>?</span> <span class='id identifier rubyid_project_attributes'>project_attributes</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>scope:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='id identifier rubyid_project_attributes'>project_attributes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="no_data-instance_method">
  
    #<strong>no_data</strong>(v)  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


151
152
153
154
155</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 151</span>

<span class='kw'>def</span> <span class='id identifier rubyid_no_data'>no_data</span><span class='lparen'>(</span><span class='id identifier rubyid_v'>v</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:email</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:first_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:last_name</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:phone_number</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:street</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:street_number</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span>
    <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:flat_number</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:zip_code</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='symbol'>:city</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="organization-instance_method">
  
    #<strong>organization</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>private method</p>

<p>returns Object - Organization from current_user</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 214</span>

<span class='kw'>def</span> <span class='id identifier rubyid_organization'>organization</span>
  <span class='ivar'>@organization</span> <span class='op'>||=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_organization'>organization</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="project_attributes-instance_method">
  
    #<strong>project_attributes</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: project attributes</p>

<p>returns Hash</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 181</span>

<span class='kw'>def</span> <span class='id identifier rubyid_project_attributes'>project_attributes</span>
  <span class='lbrace'>{</span>
    <span class='comment'># default attributes
</span>    <span class='label'>title:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_title'>title</span><span class='comma'>,</span>
    <span class='label'>body:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span><span class='comma'>,</span>
    <span class='comment'># custom
</span>    <span class='label'>short_description:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_short_description'>short_description</span><span class='comma'>,</span>
    <span class='label'>custom_categories:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_custom_categories'>custom_categories</span><span class='comma'>,</span>
    <span class='label'>custom_recipients:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_custom_recipients'>custom_recipients</span><span class='comma'>,</span>
    <span class='label'>universal_design:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_universal_design'>universal_design</span><span class='comma'>,</span>
    <span class='label'>universal_design_argumentation:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_universal_design_argumentation'>universal_design_argumentation</span><span class='comma'>,</span>
    <span class='label'>justification_info:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_justification_info'>justification_info</span><span class='comma'>,</span>
    <span class='label'>no_scope_selected:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_no_scope_selected'>no_scope_selected</span><span class='comma'>,</span>
    <span class='label'>localization_info:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_localization_info'>localization_info</span><span class='comma'>,</span>
    <span class='label'>localization_additional_info:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_localization_additional_info'>localization_additional_info</span><span class='comma'>,</span>
    <span class='label'>locations:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_locations_data'>locations_data</span><span class='comma'>,</span>
    <span class='label'>budget_value:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_budget_value'>budget_value</span><span class='comma'>,</span>
    <span class='label'>budget_description:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_budget_description'>budget_description</span><span class='comma'>,</span>
    <span class='label'>contractors_and_costs:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_contractors_and_costs'>contractors_and_costs</span><span class='comma'>,</span>
    <span class='label'>coauthor_email_one:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_coauthor1_email'>coauthor1_email</span><span class='op'>&amp;.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span>
    <span class='label'>coauthor_email_two:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_coauthor2_email'>coauthor2_email</span><span class='op'>&amp;.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='comma'>,</span>
    <span class='label'>signed_by_coauthor1:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_signed_by_coauthor1'>signed_by_coauthor1</span><span class='comma'>,</span>
    <span class='label'>signed_by_coauthor2:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_signed_by_coauthor2'>signed_by_coauthor2</span><span class='comma'>,</span>
    <span class='label'>implementation_on_main_site:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_implementation_on_main_site'>implementation_on_main_site</span><span class='comma'>,</span>
    <span class='label'>signed_by_author:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_signed_by_author'>signed_by_author</span><span class='comma'>,</span>
    <span class='label'>coauthors_data:</span> <span class='id identifier rubyid_coauthors_attributes'>coauthors_attributes</span><span class='comma'>,</span>
    <span class='label'>offensive:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_offensive'>offensive</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>?</span> <span class='kw'>false</span> <span class='op'>:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_offensive'>offensive</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_notification-instance_method">
  
    #<strong>send_notification</strong>(project)  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: send message to project authors</p>

<p>returns nothing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 324</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_notification'>send_notification</span><span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_reload'>reload</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_any_draft?'>any_draft?</span>

  <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_authors'>authors</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_inform_about_admin_changes'>inform_about_admin_changes</span>

    <span class='id identifier rubyid_mail_template'>mail_template</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>==</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_creator_author'>creator_author</span>
                      <span class='comment'># set mail_template only if creator was not changed,
</span>                      <span class='comment'># in case he was changed, he gets a different mail earlier
</span>                      <span class='kw'>if</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>==</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span>
                        <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended.html" title="Decidim::AdminExtended (module)">AdminExtended</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended/MailTemplate.html" title="Decidim::AdminExtended::MailTemplate (class)">MailTemplate</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>system_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin_edition_project_email_template</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                      <span class='kw'>end</span>
                    <span class='kw'>else</span>
                      <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@coauthors_emails</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_email'>email</span><span class='rparen'>)</span>
                        <span class='comment'># old coauthor
</span>                        <span class='kw'>if</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_coauthorships'>coauthorships</span><span class='period'>.</span><span class='id identifier rubyid_confirmed'>confirmed</span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>author:</span> <span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
                          <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended.html" title="Decidim::AdminExtended (module)">AdminExtended</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended/MailTemplate.html" title="Decidim::AdminExtended::MailTemplate (class)">MailTemplate</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>system_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>admin_edition_project_email_template</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                        <span class='kw'>end</span>
                      <span class='kw'>else</span>
                        <span class='comment'># new coauthor
</span>                        <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_sign_in_count'>sign_in_count</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
                          <span class='comment'># user that was created by system
</span>                          <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended.html" title="Decidim::AdminExtended (module)">AdminExtended</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended/MailTemplate.html" title="Decidim::AdminExtended::MailTemplate (class)">MailTemplate</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>system_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coauthor_invitation_email_template</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                        <span class='kw'>else</span>
                          <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended.html" title="Decidim::AdminExtended (module)">AdminExtended</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../AdminExtended/MailTemplate.html" title="Decidim::AdminExtended::MailTemplate (class)">MailTemplate</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by'>find_by</span><span class='lparen'>(</span><span class='label'>system_name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>coauthorship_confirmation_email_template</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
                        <span class='kw'>end</span>
                      <span class='kw'>end</span>
                    <span class='kw'>end</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_mail_template'>mail_template</span><span class='op'>&amp;.</span><span class='id identifier rubyid_filled_in?'>filled_in?</span>
      <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Projects.html" title="Decidim::Projects (module)">Projects</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../TemplatedMailerJob.html" title="Decidim::Projects::TemplatedMailerJob (class)">TemplatedMailerJob</a></span></span><span class='period'>.</span><span class='id identifier rubyid_perform_later'>perform_later</span><span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span><span class='comma'>,</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_mail_template'>mail_template</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="temporary_update_project-instance_method">
  
    #<strong>temporary_update_project</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: temporal update</p>

<p>Method saves project data in jsonb fields. Users with proper permissions can later save project with this temporal data</p>

<p>returns Project</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 269</span>

<span class='kw'>def</span> <span class='id identifier rubyid_temporary_update_project'>temporary_update_project</span>
  <span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='period'>.</span><span class='id identifier rubyid_traceability'>traceability</span><span class='period'>.</span><span class='id identifier rubyid_perform_action!'>perform_action!</span><span class='lparen'>(</span>
    <span class='symbol'>:changes_for_acceptance</span><span class='comma'>,</span>
    <span class='ivar'>@project</span><span class='comma'>,</span>
    <span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span>
    <span class='label'>visibility:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>admin-only</span><span class='tstring_end'>&quot;</span></span>
  <span class='rparen'>)</span> <span class='kw'>do</span>
    <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_update_columns'>update_columns</span><span class='lparen'>(</span>
      <span class='label'>admin_changes:</span> <span class='lbrace'>{</span>
        <span class='label'>project_attrs:</span> <span class='id identifier rubyid_handled_project_attributes'>handled_project_attributes</span><span class='comma'>,</span>
        <span class='label'>author_data:</span> <span class='id identifier rubyid_author_attributes'>author_attributes</span><span class='comma'>,</span>
        <span class='label'>coauthors_data:</span> <span class='id identifier rubyid_coauthors_attributes'>coauthors_attributes</span><span class='comma'>,</span>
        <span class='label'>whodoit_id:</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
        <span class='label'>admin_signature:</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_admin_comment_name'>admin_comment_name</span><span class='comma'>,</span>
        <span class='label'>categories:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_assigned_categories'>assigned_categories</span><span class='comma'>,</span>
        <span class='label'>recipients:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_recipients'>recipients</span><span class='comma'>,</span>
        <span class='label'>files_to_remove:</span> <span class='id identifier rubyid_attachments_to_remove'>attachments_to_remove</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span><span class='comma'>,</span>
        <span class='label'>files_to_add:</span> <span class='id identifier rubyid_attachments_save_and_list'>attachments_save_and_list</span>
      <span class='rbrace'>}</span>
    <span class='rparen'>)</span>
    <span class='ivar'>@project</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_coauthors_data-instance_method">
  
    #<strong>update_coauthors_data</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: update coauthors data returns nothing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_coauthors_data'>update_coauthors_data</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor1_data'>coauthor1_data</span> <span class='op'>=</span> <span class='id identifier rubyid_coauthors_attributes'>coauthors_attributes</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor_one'>coauthor_one</span><span class='period'>.</span><span class='id identifier rubyid_update_column'>update_column</span><span class='lparen'>(</span><span class='symbol'>:email_on_notification</span><span class='comma'>,</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_coauthor1_email_on_notification'>coauthor1_email_on_notification</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor_one'>coauthor_one</span>

  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor2_data'>coauthor2_data</span> <span class='op'>=</span> <span class='id identifier rubyid_coauthors_attributes'>coauthors_attributes</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor_two'>coauthor_two</span><span class='period'>.</span><span class='id identifier rubyid_update_column'>update_column</span><span class='lparen'>(</span><span class='symbol'>:email_on_notification</span><span class='comma'>,</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_coauthor2_email_on_notification'>coauthor2_email_on_notification</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_coauthor_two'>coauthor_two</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_creator_data-instance_method">
  
    #<strong>update_creator_data</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: update author data</p>

<p>returns nothing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 136</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_creator_data'>update_creator_data</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_author_data'>author_data</span> <span class='op'>=</span> <span class='id identifier rubyid_author_attributes'>author_attributes</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_creator_author'>creator_author</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='label'>email_on_notification:</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_email_on_notification'>email_on_notification</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_department-instance_method">
  
    #<strong>update_department</strong>(project)  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: update current department i project</p>

<p>returns nothing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


160
161
162
163
164
165
166
167
168
169</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 160</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_department'>update_department</span><span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span><span class='period'>.</span><span class='id identifier rubyid_department'>department</span>

  <span class='id identifier rubyid_department'>department</span> <span class='op'>=</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span><span class='period'>.</span><span class='id identifier rubyid_department'>department</span>
  <span class='comment'># update current department
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_department'>department</span> <span class='op'>!=</span> <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_current_department'>current_department</span>
    <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_current_department_id'>current_department_id</span> <span class='op'>=</span> <span class='id identifier rubyid_department'>department</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span>
    <span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_department_assignments'>department_assignments</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>department:</span> <span class='id identifier rubyid_department'>department</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_project-instance_method">
  
    #<strong>update_project</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Private: update project</p>

<p>Method updates project and assigns current users signature as author of changes. It creates new version and ActionLog</p>

<p>returns nothing</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'decidim-projects/app/commands/decidim/projects/admin/update_project.rb', line 106</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_project'>update_project</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_set_admin_signature'>set_admin_signature</span><span class='lparen'>(</span><span class='id identifier rubyid_current_user'>current_user</span><span class='rparen'>)</span>
  <span class='comment'># after project was published only admin can freely change scopes
</span>  <span class='comment'># for department forwarding coordinators have special action and list of available departments
</span>  <span class='id identifier rubyid_update_department'>update_department</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_project'>project</span><span class='period'>.</span><span class='id identifier rubyid_any_draft?'>any_draft?</span> <span class='op'>||</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_ad_admin?'>ad_admin?</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span> <span class='op'>!=</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_scope'>scope</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_categories'>categories</span> <span class='op'>=</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_assigned_categories'>assigned_categories</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_recipients'>recipients</span> <span class='op'>=</span> <span class='id identifier rubyid_form'>form</span><span class='period'>.</span><span class='id identifier rubyid_recipients'>recipients</span>
  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_set_visible_version'>set_visible_version</span> <span class='kw'>unless</span> <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_any_draft?'>any_draft?</span>

  <span class='ivar'>@project</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../Decidim.html" title="Decidim (module)">Decidim</a></span></span><span class='period'>.</span><span class='id identifier rubyid_traceability'>traceability</span><span class='period'>.</span><span class='id identifier rubyid_update!'>update!</span><span class='lparen'>(</span>
    <span class='ivar'>@project</span><span class='comma'>,</span>
    <span class='id identifier rubyid_current_user'>current_user</span><span class='comma'>,</span>
    <span class='id identifier rubyid_handled_project_attributes'>handled_project_attributes</span><span class='comma'>,</span>
    <span class='label'>visibility:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>all</span><span class='tstring_end'>&quot;</span></span>
  <span class='rparen'>)</span>

  <span class='id identifier rubyid_build_internal_documents_for'>build_internal_documents_for</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_build_endorsements_for'>build_endorsements_for</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_build_consents_for'>build_consents_for</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_build_files_for'>build_files_for</span><span class='lparen'>(</span><span class='ivar'>@project</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_update_creator_data'>update_creator_data</span>
  <span class='id identifier rubyid_update_coauthors_data'>update_coauthors_data</span>

  <span class='ivar'>@project</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Dec  5 11:38:24 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-2.7.3).
</div>

    </div>
  </body>
</html>